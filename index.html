<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Absensi OSIS Digital</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
    --primary:#2563eb;
    --dark:#0f172a;
    --light:#f8fafc;
    --card:#ffffff;
    --shadow:0 10px 30px rgba(0,0,0,0.08);
}

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Poppins',sans-serif;
}

html{
    scroll-behavior:smooth;
}

body{
    background:var(--light);
}

/* ================= CLEAN PREMIUM LOGIN ================= */

.login-page{
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#ffffff;
    position:relative;
    overflow:hidden;
}

/* Cahaya mengikuti mouse (soft navy glow) */
.login-page::before{
    content:"";
    position:absolute;
    width:500px;
    height:500px;
    background:radial-gradient(circle, rgba(0,31,63,0.15) 0%, transparent 70%);
    border-radius:50%;
    pointer-events:none;
    transform:translate(-50%, -50%);
    left:var(--x, 50%);
    top:var(--y, 50%);
    transition:0.08s;
}

/* LOGIN BOX */
.login-box{
    background:#ffffff;
    padding:45px;
    border-radius:25px;
    width:360px;
    text-align:center;
    border:1px solid #e5e7eb;
    box-shadow:0 25px 60px rgba(0,31,63,0.15);
    transition:0.3s ease;
}

.login-box:hover{
    transform:translateY(-6px);
    box-shadow:0 35px 80px rgba(0,31,63,0.25);
}

.login-box h2{
    margin-bottom:25px;
    color:#001f3f;
    font-weight:600;
}

/* INPUT */
.login-box input{
    width:100%;
    padding:14px;
    margin:12px 0;
    border-radius:12px;
    border:1px solid #d1d5db;
    outline:none;
    font-size:14px;
    transition:0.3s;
}

.login-box input:focus{
    border-color:#001f3f;
    box-shadow:0 0 15px rgba(0,31,63,0.25);
}

/* BUTTON */
.login-box button{
    width:100%;
    padding:14px;
    margin-top:15px;
    border:none;
    border-radius:12px;
    background:#001f3f;
    color:white;
    font-weight:500;
    cursor:pointer;
    transition:0.3s;
}

.login-box button:hover{
    background:#003366;
    box-shadow:0 0 20px rgba(0,31,63,0.4);
    transform:scale(1.03);
}

.error{
    color:#dc2626;
    font-size:13px;
    margin-top:10px;
}
.logout-btn{
    display:flex;
    align-items:center;
    gap:6px;
    background:white;
    color:#001f3f;
    border:none;
    padding:6px 12px;
    border-radius:8px;
    font-size:13px;
    cursor:pointer;
    transition:0.3s;
}

.logout-btn:hover{
    background:#ff4d4d;
    color:white;
}

.input-group{
    position:relative;
    display:flex;
    align-items:center;
    margin:14px 0;
}

.input-group input{
    width:100%;
    padding:14px 45px;
    border-radius:12px;
    border:1px solid #d1d5db;
    outline:none;
    font-size:14px;
    transition:0.3s;
}

.input-group input:focus{
    border-color:#001f3f;
    box-shadow:0 0 12px rgba(0,31,63,0.25);
}

/* ICON KIRI */
.input-icon{
    position:absolute;
    left:14px;
    color:#001f3f;
    display:flex;
    align-items:center;
}

/* TOGGLE PASSWORD */
.toggle-password{
    position:absolute;
    right:14px;
    cursor:pointer;
    color:#001f3f;
    display:flex;
    align-items:center;
    transition:0.3s;
}

.toggle-password:hover{
    transform:scale(1.1);
    color:#003366;
}

/* Smooth fade animation */
.fade-anim{
    animation:fadeSmooth 0.25s ease;
}

@keyframes fadeSmooth{
    from{opacity:0; transform:scale(0.9);}
    to{opacity:1; transform:scale(1);}
}



/* ================= DASHBOARD ================= */
.dashboard{
    display:none;
}

/* HEADER */
header{
background-color: #1c2126ff;
    color:white;
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 40px;
    position:sticky;
    top:0;
    z-index:1000;
}

.header-left{
    display:flex;
    align-items:center;
}

.header-left img{
    width:95px;
    margin-right:1px;
}

.header-left h1{
    font-size:15px;
    font-weight:600;
}

/* NAV */
nav{
    display:flex;
}

nav a{
    color:white;
    text-decoration:none;
    margin-left:25px;
    font-weight:500;
}

nav a:hover{
    color:#93c5fd;
}

/* HAMBURGER */
.menu-toggle{
    display:none;
    flex-direction:column;
    cursor:pointer;
}

.menu-toggle span{
    height:3px;
    width:25px;
    background:white;
    margin:4px 0;
}

/* HERO */
.hero{
    position:relative;
    height:340px;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    text-align:center;
}

.hero img{
    position:absolute;
    width:100%;
    height:100%;
    object-fit:cover;
    top:0;
    left:0;
}

.hero::after{
    content:"";
    position:absolute;
    bottom:0;
    left:0;
    width:100%;
    height:160px;
    background:linear-gradient(to bottom,
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,0.7) 60%,
        rgba(255,255,255,1) 100%);
}

.hero-text{
    position:relative;
    color:white;
   
   
    z-index:2;
    max-width:700px;
}

.hero-text h2{
    font-size:28px;
    margin-bottom:10px;
}

.hero-text p{
    font-size:15px;
    opacity:0.9;
}
@media(max-width:768px){
    .hero{
        height:260px;
        padding:0 20px;
    }

    .hero-text h2{
        font-size:20px;
    }

    .hero-text p{
        font-size:13px;
    }
}


/* SECTION */
.section{
    padding:60px 8%;
}

/* CARD */
.card{
    background:var(--card);
    padding:30px;
    border-radius:20px;
    box-shadow:var(--shadow);
    margin-bottom:40px;
}

/* FORM */
select,button{
    padding:10px 15px;
    border-radius:10px;
    border:1px solid #ddd;
    margin:5px;
    font-size:14px;
}

button{
   background-color: #1c2126ff;
    color:white;
    border:none;
    cursor:pointer;
}

button:hover{
    background:#1d4ed8;
}

/* TABLE */
table{
    width:100%;
    border-collapse:collapse;
    background:white;
    box-shadow:var(--shadow);
    border-radius:16px;
    overflow:hidden;
    margin-bottom:40px;
}

th{
   background-color: #1c2126ff;

    color:white;
    padding:14px;
}

td{
    padding:12px;
    text-align:center;
}

tr:nth-child(even){
    background:#f1f5f9;
}

tr:hover{
    background:#e0e7ff;
}

.delete-btn{
    background:#dc2626;
    padding:6px 10px;
    border-radius:6px;
    font-size:12px;
}

.delete-btn:hover{
    background:#b91c1c;
}

/* FOOTER */
footer{
  background-color: #1c2126ff;
    color:white;
    text-align:center;
    padding:20px;
    margin-top:150px;
}

/* MOBILE */
@media(max-width:768px){
    nav{
        position:absolute;
        top:70px;
        right:0;
        background:var(--dark);
        flex-direction:column;
        width:200px;
        display:none;
        padding:20px;
    }
    nav a{
        margin:10px 0;
    }
    nav.active{
        display:flex;
    }
    .menu-toggle{
        display:flex;
    }
}
/* ================= RESPONSIVE GLOBAL ================= */

body{
    overflow-x:hidden;
}

/* LOGIN RESPONSIVE */
@media(max-width:480px){
    .login-box{
        width:90%;
        padding:30px 20px;
        border-radius:18px;
    }

    .login-box h2{
        font-size:18px;
    }

    .input-group input{
        padding:12px 40px;
        font-size:13px;
    }

    .login-box button{
        padding:12px;
        font-size:14px;
    }
}

/* HEADER RESPONSIVE */
@media(max-width:768px){
    header{
        padding:12px 20px;
    }

    .header-left h1{
        font-size:14px;
    }

    nav{
        position:absolute;
        top:65px;
        right:0;
        background:#001f3f;
        flex-direction:column;
        width:200px;
        display:none;
        padding:20px;
        border-radius:0 0 0 15px;
    }

    nav a{
        margin:10px 0;
    }

    nav.active{
        display:flex;
    }

    .menu-toggle{
        display:flex;
    }
}

/* SECTION RESPONSIVE */
@media(max-width:768px){
    .section{
        padding:40px 20px;
    }

    .card{
        padding:20px;
    }
}

/* TABLE RESPONSIVE */
.table-container{
    width:100%;
    overflow-x:auto;
}

/* ================= TABLE GLOBAL ================= */

.table-container{
    width:100%;
    overflow-x:auto;
}

table{
    width:100%;
    border-collapse:collapse;
    background:white;
    box-shadow:0 10px 30px rgba(0,31,63,0.08);
    border-radius:16px;
    overflow:hidden;
    margin-bottom:40px;
    font-size:14px;
}

th{
    background:#001f3f;
    color:white;
    padding:14px 10px;
    text-align:center;
}

td{
    padding:12px 8px;
    text-align:center;
}

tr:nth-child(even){
    background:#f8fafc;
}

tr:hover{
    background:#e6f0ff;
    transition:0.2s;
}

/* ================= RESPONSIVE TABLE ================= */

@media(max-width:768px){

    table{
        font-size:12px;
    }

    th{
        padding:10px 6px;
    }

    td{
        padding:8px 6px;
    }

    .delete-btn{
        padding:4px 6px;
        font-size:11px;
    }
}

@media(max-width:480px){

    table{
        font-size:11px;
    }

    th, td{
        padding:6px 4px;
    }
}
/* ================= LOADING OVERLAY ================= */

#loadingOverlay{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(255,255,255,0.6);
    backdrop-filter:blur(6px);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
    opacity:0;
    visibility:hidden;
    transition:0.3s ease;
}

#loadingOverlay.active{
    opacity:1;
    visibility:visible;
}

/* Box */
.loader-box{
    background:white;
    padding:30px 40px;
    border-radius:20px;
    box-shadow:0 20px 50px rgba(0,31,63,0.2);
    text-align:center;
    animation:fadeUp 0.4s ease;
}

.loader-box p{
    margin-top:15px;
    color:#001f3f;
    font-weight:500;
}

/* Spinner */
.spinner{
    width:45px;
    height:45px;
    border:5px solid #e5e7eb;
    border-top:5px solid #001f3f;
    border-radius:50%;
    animation:spin 1s linear infinite;
}

@keyframes spin{
    to{ transform:rotate(360deg); }
}

.section{
    padding:60px 8%;
    animation:fadePage 0.4s ease;
}

@keyframes fadePage{
    from{opacity:0; transform:translateY(20px);}
    to{opacity:1; transform:translateY(0);}
}
/* ===== DASHBOARD STAT CARD ===== */
.stats-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:20px;
    margin-bottom:40px;
}

.stat-card{
    background:white;
    padding:25px;
    border-radius:18px;
    box-shadow:0 15px 40px rgba(0,31,63,0.1);
    text-align:center;
    transition:0.3s;
}

.stat-card:hover{
    transform:translateY(-5px);
}

.stat-card h3{
    font-size:28px;
    margin-bottom:5px;
    color:#001f3f;
}

.stat-card p{
    font-size:13px;
    color:#64748b;
}

/* ===== BADGE ===== */
.badge{
    padding:5px 10px;
    border-radius:20px;
    font-size:11px;
    font-weight:500;
    color:white;
}

.badge-aktif{ background:#16a34a; }
.badge-cukup{ background:#f59e0b; }
.badge-kurang{ background:#dc2626; }

/* ===== TOAST ===== */
.toast{
    position:fixed;
    top:30px;
    right:30px;
    background:#16a34a;
    color:white;
    padding:15px 25px;
    border-radius:12px;
    box-shadow:0 15px 40px rgba(0,0,0,0.2);
    transform:translateX(150%);
    transition:0.4s;
    z-index:9999;
}

.toast.show{
    transform:translateX(0);
}

/* ============================= */
/* PERAPIAN NAVBAR KHUSUS LAPTOP */
/* ============================= */
@media (min-width: 992px){

    #navMenu{
        display:flex;
        align-items:center;
        justify-content:flex-end;
        gap:26px;
    }

    #navMenu a{
        font-size:14px;
        padding:8px 14px;
        border-radius:8px;
        transition:0.3s;
    }

    #navMenu a:hover{
        background:rgba(255,255,255,0.15);
    }

    .logout-btn{
        padding:8px 16px;
        border-radius:8px;
    }

}

/* ============================= */
/* WARNA NAVBAR KHUSUS HP */
/* ============================= */
@media (max-width: 991px){

    #navMenu{
        background: #1c2126ff;
    }

    #navMenu a{
        color: white;
    }

    .logout-btn{
        background: #dc2626; /* tetap merah logout */
        color: white;
    }

}
/* ============================= */
/* LOGOUT PUTIH KHUSUS MODE HP */
/* ============================= */
@media (max-width: 991px){

    .logout-btn{
        background: white;
        color: #1c2126ff; /* teks gelap supaya terlihat */
        border: none;
    }

}


</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div class="login-page" id="loginPage">
<div class="login-box">
<h2>Login Admin Sekretaris</h2>
<div class="input-group">
    <span class="input-icon">
        <!-- User Icon SVG -->
        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"/>
        </svg>
    </span>
    <input type="text" id="username" placeholder="Username">
</div>

<div class="input-group password-group">
    <span class="input-icon">
        <!-- Lock Icon SVG -->
        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M12 17a2 2 0 0 0 2-2c0-.7-.3-1.3-.8-1.7V11a1.2 1.2 0 0 0-2.4 0v2.3c-.5.4-.8 1-.8 1.7a2 2 0 0 0 2 2zm6-6h-1V8a5 5 0 0 0-10 0v3H6a2 2 0 0 0-2 2v7h16v-7a2 2 0 0 0-2-2zM9 8a3 3 0 0 1 6 0v3H9V8z"/>
        </svg>
    </span>

    <input type="password" id="password" placeholder="Password">

    <span class="toggle-password" onclick="togglePassword()">
        <!-- Eye Icon SVG -->
        <svg id="eyeIcon" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/>
        </svg>
    </span>
</div>

<button onclick="login()">Masuk</button>
<div class="error" id="errorMsg"></div>
</div>
</div>

<!-- DASHBOARD -->
<div class="dashboard" id="dashboard">

<header>
<div class="header-left">
<img src="logo1.png">
</div>

<div class="menu-toggle" onclick="toggleMenu()">
<span></span>
<span></span>
<span></span>
</div>

<nav id="navMenu">
    <a href="#" onclick="showPage('kehadiran')">Kehadiran</a>
    <a href="#" onclick="showPage('rekapPage')">Rekap</a>
    <a href="#" onclick="showPage('kegiatanFullPage')">Absensi Kegiatan</a>

    <button class="logout-btn" onclick="logout()">
        Logout
    </button>
</nav>

</header>

<div class="hero">
<img src="foto2.png">
</div>

<!-- ================= HALAMAN ABSENSI ================= -->
<div class="section" id="kehadiran">

    <div class="card">
        <h2>Input Absensi</h2>

        <select id="anggotaSelect"></select>

        <select id="keterangan">
            <option value="Hadir">Hadir</option>
            <option value="Izin">Izin</option>
            <option value="Alpa">Alpa</option>
        </select>

        <button onclick="tambahAbsensi()">Absen</button>
    </div>

    <div class="table-container">
        <h2>Data Kehadiran</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nama</th>
                    <th>Tanggal</th>
                    <th>Keterangan</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="tabelAbsensi"></tbody>
        </table>
    </div>

</div>


<!-- Statistik -->
<div class="stats-grid">
    <div class="stat-card">
        <h3 id="totalHadir">0</h3>
        <p>Total Hadir</p>
    </div>
    <div class="stat-card">
        <h3 id="totalIzin">0</h3>
        <p>Total Izin</p>
    </div>
    <div class="stat-card">
        <h3 id="totalAlpa">0</h3>
        <p>Total Alpa</p>
    </div>
    <div class="stat-card">
        <h3 id="persenHadir">0%</h3>
        <p>Persentase Kehadiran</p>
    </div>
</div>

<!-- ================= HALAMAN REKAP ================= -->
<div class="section" id="rekapPage" style="display:none;">

    <div class="card">
        <h2>Rekap Bulanan</h2>
        <p style="margin-bottom:15px; color:#64748b;">
            Data rekap otomatis berdasarkan bulan berjalan.
        </p>

        <button onclick="printData()" class="export-btn">
            Export / Print Data
        </button>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nama</th>
                    <th>Hadir</th>
                    <th>Izin</th>
                    <th>Alpa</th>
                </tr>
            </thead>
            <tbody id="tabelRekap"></tbody>
            <div class="toast" id="toastNotif">
    Absensi Berhasil âœ…
</div>

        </table>
    </div>

</div>

<!-- ================= HALAMAN FULL ABSENSI KEGIATAN ================= -->
<div class="section" id="kegiatanFullPage" style="display:none;">

    <div class="card">
        <h2>Absensi Kegiatan OSIS</h2>

        <input type="text" id="namaKegiatan"
        placeholder="Nama Kegiatan"
        style="padding:10px;border-radius:10px;border:1px solid #ddd;margin:5px;width:250px;">

        <select id="anggotaSelectKegiatan"></select>

        <button onclick="simpanAbsensiKegiatan()">Simpan</button>
<button onclick="printKegiatan()">Print Data</button>
<button onclick="hapusSemuaKegiatan()" style="background:#dc2626;">
    Hapus Semua
</button>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nama</th>
                    <th>Kegiatan</th>
                    <th>Tanggal</th>
                    <th>TTD</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="tabelKegiatan"></tbody>
        </table>
    </div>

</div>



<footer>
Â© 2026 Sekbid 8 - Sistem Absensi Digital
</footer>

<script>
/* LOGIN SYSTEM */
const ADMIN_USER="admin";
const ADMIN_PASS="123";

function login(){
let user=document.getElementById("username").value;
let pass=document.getElementById("password").value;

if(user===ADMIN_USER && pass===ADMIN_PASS){
sessionStorage.setItem("login","true");
showDashboard();
}else{
document.getElementById("errorMsg").innerText="Username atau Password salah!";
}
}

function logout(){
sessionStorage.removeItem("login");
location.reload();
}

function showDashboard(){
document.getElementById("loginPage").style.display="none";
document.getElementById("dashboard").style.display="block";
}

if(sessionStorage.getItem("login")==="true"){
showDashboard();
}

function toggleMenu(){
document.getElementById("navMenu").classList.toggle("active");
}

/* ================= DATA ================= */

let namaList=[
"ABDUL GHOFUR",
"AKHMAD NUR FAIZI",
"ALIFAH ISNA NUR .A",
"ANDAN BUDI ELHA",
"DENITA AOLIA",
"DWI AGUSTINA",
"FELIX FAHRI ARVABILLIE SYAHREZA",
"HAIDAR AMIR .M",
"HAZEL RILO MAULA",
"HILDAN NUR JOHANTO",
"JUAN DWI SATRIO",
"KHOLIVIA NURHANAN",
"MUHAMMAD TAMAAM ZAYYAN",
"MUSTIKA SEKAR PAMBAYUN",
"NAZIH AFDAN NAUFAL",
"PANCA MAULANA",
"RIFKY ADI NUGROHO",
"TARA JULIANI",
"VICKI ILHAM RAMADHAN",
"WISNU KURNIAWAN",
"YOGA SETIA ROMADHON",
"ZAHRA AGUSTIN",
"ZAHRA ANTIKA",
"ZOYA ATHA AKBARI",
"ANDINI SILFIANI",
"ALIYAH HIKMATUL GINA",
"ALINDA PUSPITA SARI",
"ARUM SULIS SETIYAWATI",
"BILLY GO PUTRA",
"CHUSNULLYA DWI ANGGITA",
"DEANDRA SEPTRIYASA",
"DUWI FIRDA TASYA AULIA PUTRI",
"DWI AZZAHRA QOTRUNNASYIFA",
"EVA ISMAFUL HAWA",
"EVI NURAENI",
"GITA AYU LESTARI",
"HEFI ANANDA",
"IBNU HUDA ALFANSYI",
"INAYA WIGATI LULU HANA",
"JEANA AMANDA RIZKY",
"MUTMAINAH",
"NABILA DWI NUR AINI",
"NAZRIL AFDAN HAMID",
"RANEVA APRILIA .S",
"RATIH KURNIASIH",
"SUCI DWI RAMADANI",
"SYAE LUHUR PAKARTI",
"TRI ERMAWATI",
"VILA FANDIRA MAHESWARI"
];

let anggotaOSIS=namaList.map((n,i)=>({id:i+1,nama:n}));
let dataAbsensi=JSON.parse(localStorage.getItem("dataAbsensi"))||[];

let select=document.getElementById("anggotaSelect");

anggotaOSIS.forEach(a=>{
let o=document.createElement("option");
o.value=a.id;
o.textContent=a.id+" - "+a.nama;
select.appendChild(o);
});

/* ================= TAMBAH ABSENSI ================= */

function tambahAbsensi(){
let id=parseInt(select.value);
let ket=document.getElementById("keterangan").value;
let today=new Date();

let tanggal=today.toISOString().split("T")[0];
let jam=today.toTimeString().split(" ")[0];

if(dataAbsensi.find(d=>d.id===id && d.tanggal===tanggal)){
alert("Tidak bisa absen 2x dalam 1 hari!");
return;
}

let anggota=anggotaOSIS.find(a=>a.id===id);

dataAbsensi.push({
id:id,
nama:anggota.nama,
tanggal:tanggal,
jam:jam,
keterangan:ket,
bulan:today.getMonth(),
tahun:today.getFullYear()
});

localStorage.setItem("dataAbsensi",JSON.stringify(dataAbsensi));

tampilkanAbsensi();
tampilkanRekap();
updateStats();
showToast();

if(select.selectedIndex<select.options.length-1){
select.selectedIndex++;
}
}

/* ================= TABEL ABSENSI ================= */

function tampilkanAbsensi(){
let tbody=document.getElementById("tabelAbsensi");
tbody.innerHTML="";
dataAbsensi.forEach((d,i)=>{
let r=tbody.insertRow();
r.insertCell(0).innerHTML=d.id;
r.insertCell(1).innerHTML=d.nama;
r.insertCell(2).innerHTML=d.tanggal;
r.insertCell(3).innerHTML=d.keterangan;
r.insertCell(4).innerHTML=`<button class="delete-btn" onclick="hapus(${i})">Hapus</button>`;
});
}

function hapus(i){
if(confirm("Apakah kamu yakin akan menghapus data ini?")){
dataAbsensi.splice(i,1);
localStorage.setItem("dataAbsensi",JSON.stringify(dataAbsensi));
tampilkanAbsensi();
tampilkanRekap();
updateStats();
}
}

/* ================= REKAP FIX ================= */

function tampilkanRekap(){
let now=new Date();
let bulan=now.getMonth();
let tahun=now.getFullYear();
let tbody=document.getElementById("tabelRekap");
tbody.innerHTML="";

anggotaOSIS.forEach(a=>{
let hadir=0,izin=0,alpa=0;

dataAbsensi.forEach(d=>{
if(d.id===a.id && d.bulan===bulan && d.tahun===tahun){
if(d.keterangan==="Hadir") hadir++;
if(d.keterangan==="Izin") izin++;
if(d.keterangan==="Alpa") alpa++;
}
});

let total = hadir+izin+alpa;
let persen = total>0 ? (hadir/total)*100 : 0;


let r=tbody.insertRow();
r.insertCell(0).innerHTML=a.id;
r.insertCell(1).innerHTML=a.nama;
r.insertCell(2).innerHTML=hadir;
r.insertCell(3).innerHTML=izin;
r.insertCell(4).innerHTML=alpa;
r.insertCell(5).innerHTML=status;
});
}

/* ================= PRINT ================= */

function printData(){
const overlay=document.getElementById("loadingOverlay");
overlay.classList.add("active");

setTimeout(()=>{
const printContents=document.querySelector("#rekapPage .table-container").innerHTML;
document.body.innerHTML=`
<div style="padding:40px;">
<h2 style="text-align:center; margin-bottom:20px;">
Laporan Data Kehadiran
</h2>
${printContents}
</div>`;
window.print();
location.reload();
},1200);
}

/* ================= STATS ================= */

function updateStats(){
let now=new Date();
let bulan=now.getMonth();
let tahun=now.getFullYear();

let hadir=0, izin=0, alpa=0;

dataAbsensi.forEach(d=>{
if(d.bulan===bulan && d.tahun===tahun){
if(d.keterangan==="Hadir") hadir++;
if(d.keterangan==="Izin") izin++;
if(d.keterangan==="Alpa") alpa++;
}
});

let total=hadir+izin+alpa;
let persen= total>0 ? Math.round((hadir/total)*100) : 0;

document.getElementById("totalHadir").innerText=hadir;
document.getElementById("totalIzin").innerText=izin;
document.getElementById("totalAlpa").innerText=alpa;
document.getElementById("persenHadir").innerText=persen+"%";
}

/* ================= TOAST ================= */

function showToast(){
let toast=document.getElementById("toastNotif");
toast.classList.add("show");
setTimeout(()=>{toast.classList.remove("show");},2000);
}

/* ================= NAVIGATION ================= */

function showPage(pageId){

    document.getElementById("kehadiran").style.display="none";
    document.getElementById("rekapPage").style.display="none";
    document.getElementById("kegiatanFullPage").style.display="none";

    document.getElementById(pageId).style.display="block";

    window.scrollTo({top:0,behavior:"smooth"});
}


/* ================= INIT ================= */

tampilkanAbsensi();
tampilkanRekap();
updateStats();

/* ================= ABSENSI KEGIATAN MANUAL ================= */

let dataKegiatan = JSON.parse(localStorage.getItem("dataKegiatan")) || [];
let anggotaSelectKegiatan = document.getElementById("anggotaSelectKegiatan");

anggotaOSIS.forEach(a=>{
    let o=document.createElement("option");
    o.value=a.id;
    o.textContent=a.id+" - "+a.nama;
    anggotaSelectKegiatan.appendChild(o);
});

function simpanAbsensiKegiatan(){
    let id=parseInt(anggotaSelectKegiatan.value);
    let kegiatan=document.getElementById("namaKegiatan").value;
    let today=new Date().toISOString().split("T")[0];

    if(!kegiatan){
        alert("Isi nama kegiatan!");
        return;
    }

    let anggota=anggotaOSIS.find(a=>a.id===id);

    dataKegiatan.push({
        id:id,
        nama:anggota.nama,
        kegiatan:kegiatan,
        tanggal:today
    });

    localStorage.setItem("dataKegiatan",JSON.stringify(dataKegiatan));

    tampilkanKegiatan();

    // ðŸ”¥ AUTO PINDAH KE ANGGOTA BERIKUTNYA
    if(anggotaSelectKegiatan.selectedIndex < anggotaSelectKegiatan.options.length - 1){
        anggotaSelectKegiatan.selectedIndex++;
    }

    alert("Absensi kegiatan berhasil disimpan!");
}

function tampilkanKegiatan(){
    let tbody=document.getElementById("tabelKegiatan");
    tbody.innerHTML="";

    dataKegiatan.forEach((d,i)=>{
        let r=tbody.insertRow();
        r.insertCell(0).innerHTML=d.id;
        r.insertCell(1).innerHTML=d.nama;
        r.insertCell(2).innerHTML=d.kegiatan;
        r.insertCell(3).innerHTML=d.tanggal;

        // ðŸ”¥ Kolom kosong untuk TTD manual
        r.insertCell(4).innerHTML="<div style='height:40px;border-bottom:1px solid #000;'></div>";

        r.insertCell(5).innerHTML=
        `<button class="delete-btn" onclick="hapusKegiatan(${i})">Hapus</button>`;
    });
}

function hapusSemuaKegiatan(){

    if(confirm("Yakin ingin menghapus semua data kegiatan ini?")){

        dataKegiatan = [];
        localStorage.removeItem("dataKegiatan");

        document.getElementById("namaKegiatan").value = "";
        anggotaSelectKegiatan.selectedIndex = 0;

        tampilkanKegiatan();

        alert("Semua data kegiatan berhasil dihapus.");
    }
}


tampilkanKegiatan();
function printKegiatan(){

    const overlay = document.getElementById("loadingOverlay");
    overlay.classList.add("active");

    setTimeout(()=>{

        const rows = dataKegiatan.map(d=>`
            <tr>
                <td>${d.id}</td>
                <td>${d.nama}</td>
                <td>${d.kegiatan}</td>
                <td>${d.tanggal}</td>
                <td style="height:40px;border-bottom:1px solid #000;"></td>
            </tr>
        `).join("");

        const printContent = `
            <div style="padding:40px;">
                <h2 style="text-align:center; margin-bottom:20px;">
                    Laporan Absensi Kegiatan
                </h2>
                <table border="1" cellspacing="0" cellpadding="8" width="100%" style="border-collapse:collapse; text-align:center;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nama</th>
                            <th>Kegiatan</th>
                            <th>Tanggal</th>
                            <th>TTD</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${rows}
                    </tbody>
                </table>
            </div>
        `;

        document.body.innerHTML = printContent;

        window.print();
        location.reload();

    },1000);
}


</script>

<div id="loadingOverlay">
    <div class="loader-box">
        <div class="spinner"></div>
        <p>Menyiapkan Data...</p>
    </div>
</div>

</body>
</html>
